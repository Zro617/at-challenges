<!DOCTYPE html>
<html>
<head>
 <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
</head>
<body>
	<h1>EncloCreations "Challenge": Encoder &amp; Decoder</h1>
	<h2>Written in JS by <a href="https://scratch.mit.edu/users/Zro716">Zro716</a>(<a href="https://github.com/Zro617/">Zro617</a>)</h2>
	<div class="decrypt">Decrypted message:
	<br><textarea id="decrypted" rows="5" cols="100" placeholder="Put your secret message here..."></textarea>
	<br><button id="encrypt" onclick="encrypt()">Encrypt</button>
	</div>
	<div =class="key">Key for message:
	<br><textarea id="key" rows="5" cols="100" placeholder="A key will be generated here for encrypting."></textarea>
	<br>
	</div>
	<div class="encrypt">Encrypted message:
	<br><textarea id="encrypted" rows="5" cols="100" placeholder="Put an encrypted message here..."></textarea>
	<br><button id="decrypt" onclick="decrypt()">Decrypt</button>
	</div>
	
</body>
<script>
/* Code by @Zro716 ( https://scratch.mit.edu/users/Zro716/ )
 * Challenge by @EncloCreations at https://scratch.mit.edu/discuss/topic/169806/
 */
var CHARS = "\n !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~";

var EncryptedElem = document.getElementById("encrypted"),
	DecryptedElem = document.getElementById("decrypted"),
	KeyElem       = document.getElementById("key");

function parse(m) {
    for (var i=m.length-1,t="",a=[];i>-1;) { t=""+m[i--]+t;if(""+t[0]+t[1]=="0x")a.unshift(t),t=""; }
    return a;
}

function decrypt() {
    var e = EncryptedElem.value, k = KeyElem.value, d = "";
    if (!e) return alert("No data to decrypt.");
	if (!k) return alert("Missing key for data.");
    e=parse(e);
    while(e.length>k.length)e.pop();
    for (var i=0;i<e.length;i++){
    	e[i]=""+~~e[i];
    	while(e[i].length<6)e[i]="0"+e[i];
    	e[i]=e[i].substring(2*(k[i]-1),2*k[i]);
    	d+=CHARS[~~e[i]];
    }
    DecryptedElem.value = d;
}

function encrypt() {
	var e = [], k = [], d = DecryptedElem.value;
	if(!d)return alert("No data to encrypt.");
	for (var i=0,r=Math.random,x,y,z;i<d.length;i++){
		x=3,y=[],z=~~(3*r());
		while(x--)y.push(""+~~(100*r()));
		y[z]=CHARS.indexOf(d[i]);
		for(x=0;x<3;x++){
			y[x]=""+y[x];
			if(y[x].length<2)y[x]="0"+y[x];
		}
		e.push("0x"+(~~y.join('')).toString(16));
		k.push(z+1);
	}
	EncryptedElem.value = e.join('');
	KeyElem.value = k.join('');
}
</script>
<script id="obsolete">
/*
function ajax(type, url, async, callback) {
    var xhr = new XMLHttpRequest();
    xhr.open(type, url, async);
    if (async) xhr.responseType = "document";
    xhr.onload = function () {
        if (xhr.status == 200) callback(xhr.responseXML);
        else console.log(xhr.statusText);
    };
    xhr.send();
}

function getDataFromTopic() {
    var thingy, key;
    // get message
    ajax("GET","https://scratch.mit.edu/discuss/topic/169806/", true, function (dom) {
        thingy = dom.getElementsByClassName("post_body_html")[0].getElementsByClassName("bb-small")[0].innerHTML;
        EncryptedElem.value = thingy;
        if (thingy && key) decrypt();
    });
    // get key
    ajax("GET", "https://scratch.mit.edu/discuss/topic/169806/?page=2", true, function (dom) {
        key = dom.getElementById("p1628095").getElementsByClassName("postright")[0].innerHTML.match(/[123]{10,}/)[0];
        KeyElem.value = key;
        if (thingy && key) decrypt();
    });
}

function IntToBinary(num,bits) {
    num = ~~num;
    var bin = "";
    while (num || bits) {
        bin = "" + (num % 2) + bin;
        num = ~~(num / 2);
        bits--;
    }
    return bin;
}

getDataFromTopic();
*/
</script>
</html>
